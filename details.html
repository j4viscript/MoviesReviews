<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>
			Peliculas Free
		</title>
		<!-- ENLAZAR VUE JS -->
		<script src="https://unpkg.com/vue@3"></script>
		<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/daisyui@2.27.0/dist/full.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" type="text/css" href="main.css">
	</head> 
	<body class="bg-white dark:bg-slate-800 rounded-lg px-6 py-8 ring-1 ring-slate-900/5 shadow-xl">
        <div id="contenedor" >
			<a class="btn glass" href="movies.html">Back</a>
			<div class="content">
				  <div class="card m-5 card-side bg-base-100 shadow-xl">
					<figure class="w-full h-full"><img :src="`https://image.tmdb.org/t/p/w500/${movie.poster_path}`"></figure>
					<div class="card-body">
					  <h2 class="card-title text-white">{{movie.title}}</h2>
					  <h2>Synopsis:</h2>
					  <p class="text-gray-200">{{movie.overview}}</p>
					  <h2>Original Language: </h2>
					  <p class="text-gray-200">{{movie.original_language}}</p>
					  <h2>Release Date:</h2>
					  <p class="text-gray-200">{{movie.release_date}}</p>
					  <h2>Estrellas</h2>
					  <p class="text-gray-200">{{rate}}</p>
					  <div class="card-actions justify-end">
						<div class="rating rating-lg rating-half">
							<div class="rating rating-half">
								<input type="radio" name="rating-10" class="rating-hidden" checked />
								<input v-on:click="darRate(0.5, movie); obtenerRate()" type="radio" name="rating-10" class="bg-orange-400 mask mask-star-2 mask-half-1" />
								<input v-on:click="darRate(1, movie); obtenerRate()" type="radio" name="rating-10" class="bg-orange-400 mask mask-star-2 mask-half-2" />
								<input v-on:click="darRate(1.5, movie); obtenerRate()" type="radio" name="rating-10" class="bg-orange-400 mask mask-star-2 mask-half-1" />
								<input v-on:click="darRate(2, movie); obtenerRate()" type="radio" name="rating-10" class="bg-orange-400 mask mask-star-2 mask-half-2" />
								<input v-on:click="darRate(2.5, movie); obtenerRate()" type="radio" name="rating-10" class="bg-orange-400 mask mask-star-2 mask-half-1" />
								<input v-on:click="darRate(3, movie); obtenerRate()" type="radio" name="rating-10" class="bg-orange-400 mask mask-star-2 mask-half-2" />
								<input v-on:click="darRate(3.5, movie); obtenerRate()" type="radio" name="rating-10" class="bg-orange-400 mask mask-star-2 mask-half-1" />
								<input v-on:click="darRate(4, movie); obtenerRate()" type="radio" name="rating-10" class="bg-orange-400 mask mask-star-2 mask-half-2" />
								<input v-on:click="darRate(4.5, movie); obtenerRate()" type="radio" name="rating-10" class="bg-orange-400 mask mask-star-2 mask-half-1" />
								<input v-on:click="darRate(5, movie); obtenerRate()" type="radio" name="rating-10" class="bg-orange-400 mask mask-star-2 mask-half-2" />
						  </div>
						  <button @click="quitarRate(movie)" class="bg-red-500 ml-5 px-3 py-2 rounded text-gray-100 mb-3">Delete Rating</button>
						</div>
					</div>
				  </div>
			</div>
        </div>
		</div>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
            <script type="text/javascript">
				var peliculas = localStorage.getItem('movie');
				peliculas = JSON.parse(peliculas);    
				this.movie = peliculas.info;
				const { createApp } = Vue;  

			const app = createApp({
				data(){
					return {
						user:null, 
						inAction: 'show',
						name:'',
						id:0,
						movie: [],
						value: null,
						rate : 0
					}
				},
				methods: {

					load(){
						var peliculas = localStorage.getItem('movie');
						peliculas = JSON.parse(peliculas);    
						this.movie = peliculas.info;
						_self = this;
						_self.movie_id = peliculas.info.id;
					},
					detalles(mv) {
						this.movie = mv
					},
					count(rating) {
						this.value = rating
						console.log(rating)
					},
					darRate(rating, mv){
						var data = JSON.stringify({
						  "value": rating
						});
						
						var config = {
						  method: 'post',
						  url: 'https://api.themoviedb.org/3/movie/'+ mv.id +'/rating',
						  headers: { 
							'Authorization': 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIwZjMzZWI5MjczNDMwYzE0OTkwNzM2MGU3ZTk1ZTVlNyIsInN1YiI6IjYzMWUyZWI4Yjg3YWVjMDA3Zjg5N2UyYiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.VGSFNA0O6HUgqky9J7NTZU6ncl8mNstDGSTo1LWRfBM', 
							'Content-Type': 'application/json'
						  },
						  data : data
						};
						
						axios(config)
						.then(function (response) {
							console.log('Tu rese√±a es de ' + rating);
						})
						.catch(function (error) {
						  console.log(error);
						});						
					},
					quitarRate(mv){
						var config = {
						  method: 'delete',
						  url: 'https://api.themoviedb.org/3/movie/'+mv.id+'/rating',
						  headers: { 
							'Authorization': 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIwZjMzZWI5MjczNDMwYzE0OTkwNzM2MGU3ZTk1ZTVlNyIsInN1YiI6IjYzMWUyZWI4Yjg3YWVjMDA3Zjg5N2UyYiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.VGSFNA0O6HUgqky9J7NTZU6ncl8mNstDGSTo1LWRfBM'
						  },
						};
						axios(config)
						.then(function (response) {
							console.log("se ah quitado tu calificacion");
						})
						.catch(function (error) {
						  console.log(error);
						});						
					},

					obtenerRate() {
						let _self = this;
						let star = false;
						var config = {
							method: 'get',
							url: 'https://api.themoviedb.org/3/account/{account_id}/rated/movies',
							headers: {
								'Authorization': 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJkZWRjOWQ0OTY0ZmVhMDA4YmVkNGVkMjc0ZDZkN2JjOSIsInN1YiI6IjYzMjAxYTY3Y2MyNzdjMDA4YTYxMTU3ZCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.7SvRwk9oBs-BTvnhJe74ufeZZ43f3QhGqHGvVDWlxXc'
							}
						};
	
						axios(config)
							.then(function (response) {
								for (i = 0; i < response.data.results.length; i++) {
									if (response.data.results[i].id == _self.movie.id) {
										_self.rate = response.data.results[i].rating
										star=true;
									}
									else if (!star) {
										_self.rate = 0;
									}
								}
								app.$forceUpdate();
							})
							.catch(function (error) {
								console.log(error);
							});
					},
				},
				mounted(){
                    this.load()
				}
			}).mount('#contenedor')
		</script>
	</body>
</html>